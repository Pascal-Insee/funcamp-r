---
title: "Chapitre 6 - L'ivresse des beaux graphiques"
output: 
  html_document:
    theme: cerulean
    highlight: haddock
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
    number_sections: false
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---


```{r setup, include=FALSE}
library(learnr)
library(parsons)
library(dplyr)
library(ggformula)
library(readxl)
base_individus <- tibble(poids = sort(rnorm(100, mean = 80, sd = 30)), taille = sort(rnorm(100, mean = 170, sd = 20)), nombre = rnorm(100, 100, 50), sexe = sample(c("H","F"),size = 100,replace = T), age = rep(c("20","40","60","80"), 25),numind=1:100)
donnees_secretes <- read_excel("../../data/nbguerriers.xlsx")

```

## Le sortilège gf_point
gf_point est un sortilège permettant de représenter des nuages de points. Il faut introduire a minima,deux ingrédients dans la recette du sortilège: l'abcisse x des points et leur ordonnée y. Cela se traduit en langage des Runes par : gf_point(y~x).

A partir, de ce qui précèdre, quel est le code pour faire un nuage de points à partir de la table *base_individus* en représentant le poids (variable `poids`) en ordonnées et la taille (variable `taille`) en abcisse ?

```{r module2-etape2,exercise=TRUE}
# Crée le graphique


# Fin de l'exercice
``` 

```{r module2-etape2-solution}
# Crée le graphique
base_individus %>%
  gf_point(poids ~ taille)
# Fin de l'exercice
``` 


Bravo, tu maîtrises parfaitement les fondamentaux pour tracer un nuage de points ! Mais, entre nous, le résultat n'est pas très esthétique pour l'instant. Et si nous apprenions, avec le langage runique, à produire des graphiques chatoyants ?


##  Oh les jolis graphiques

À partir du graphique précédent, 

```{r t1, eval = FALSE}

base_individus %>%
  
  gf_point(poids ~ taille)

```
###  Assez de la grisaille ? On passe à la couleur

Comment faire pour différencier sur le même graphique les points concernant les femmes, des hommes ?
On peut le faire en utilisant l'ingrédient **color** pour changer la couleur ("qui est fixe par défaut") `en fonction de` la variable sexe.  Tu as compris qu'il faut aussi utiliser l'operateur `~`. L'ingrédient **color** sera donc égal à ~ sexe.

Et voilà :

```{r t2, collapse = TRUE}

base_individus %>%
  
  gf_point(poids ~ taille, title = "Courbe de poids en fonction de la taille", color = ~sexe )

```

###  Des points qui changent de taille, dites-vous ? Hips.

Puisqu'on y est, si je veux faire varier la taille des ronds d'un nuage de points en fonction de la valeur d'une variable dénommeée nombre, j'utilise l'ingrédient **size** et lui donne la valeur ~ nombre : size = ~nombre. Dans l'exemple qui suit, je vais ainsi représenter sur un nuage de points le nombre d'habitants des royaumes selon le nombre de guerriers et faire varier la taille des ronds proportionnellement au nombre de chevaux de chaque royaume. L'ensemble des informations se trouve dans le fichier donnees_secretes.

```{r t3, collapse = TRUE}

donnees_secretes %>%
  
  gf_point(nb_habitants ~ nb_guerriers, title = "Les royaumes, selon le nombre d'habitants, de guerriers et de chevaux", size = ~ nb_chevaux)

```

###  Des points qui ne sont plus des points ? 

Au risque de rendre le graphique plus difficile à lire, je peux aussi changer la forme des points du nuage de points en attribuant une valeur à l'ingrédient **shape** (forme en anglais). Par exemple, en lui affectant une valeur fixe shape = 1 (un chiffre entre 0 et 25)  ou en lui affectant une valeur qui varie comme cela shape = ~ variable. Dans notre cas, on va attribuer une forme dépendant de la position des royaumes par rapport au royaume d'ICarius. 

```{r t4, collapse = TRUE}

donnees_secretes %>%
  
  gf_point(nb_habitants ~ nb_guerriers, title = "Les royaumes, selon le nombre d'habitants, de guerriers et de chevaux", size = ~ nb_chevaux,shape = ~situation)

```

###  Des points qui ont des petits noms 

Il est également possible de faire figurer des noms associés à chaque point représenté. Dans notre exemple, nous allons attribuer à chaque point le nom du royaume correspondant. Pour cela, il faut combiner le sortilège gf_point avec un autre sortilège : gf_text. Le sortilège gf_text a lui aussi besoin d'ingrédients. Dans notre cas, on va se limiter au **label** qui permet d'indiquer le nom de la variable que l'on veut voir apparaitre (ici la variable royaume), puis **color** et **size** pour la couleur et la taille de la police. On va juste ajouter un peu de glutamate avec l'ingrédient **check_overlap** qui permet de s'assurer que les textes affichés ne se superposent pas, si sa valeur est définie à TRUE. 
Attention à ne pas oublier le symbole ~ dans l'utilisation de l'ingrédient **label**.

```{r t4b, collapse = TRUE}

donnees_secretes %>%
  gf_point(nb_habitants ~ nb_guerriers, title = "Les royaumes, selon le nombre d'habitants, de guerriers et de chevaux", size = ~ nb_chevaux)%>%
  gf_text(label = ~ royaume, color='black', size=2.5,check_overlap=TRUE)

```

Tu sais maintenant faire de beaux graphiques. J'en connais un qui va être furieux.


## À toi de jouer

Pour contrer les velléités du vil Parlyus, Icarius doit identifier un royaume le plus difficile à conquérir pour son armée, selon trois critères, l'éloignement du royaume à conquérir depuis le royaume d'Icarius, le nombre d'hommes armés et enfin le nombre de jours de canicule. Pour identifier ce royaume, il va s'appuyer sur un graphique permettant de représenter en abcisse la distance de chaque royaume au royaume d'Icarius, en ordonnée le nombre de jours de canicule dans ces royaumes. Dans ce graphique, la taille des points varie selon le nombre de guerriers. L'ensemble des informations nécessaires se trouve dans le fichier donnees_secretes.
À partir de ce fichier et des exemples présentés précédemment, aide Icarius à identifier le royaume à proposer à Parlyus.

Quelques indices :
- le nombre de jour de canicule est contenu dans la variable `nb_canicule`
- la distance au royame est contenue dans la variable `dist_royaume`
- le nombre de guerriers est contenu dans la variable `nb_guerriers`
- pour représenter un nuage de point, le sortilège à utiliser est `gf_point()`


```{r chapitre6-ex1,exercise=TRUE}
# Créez le graphique



# Fin de l'exercice
``` 

```{r chapitre6-ex1-solution}
# Crée le graphique

donnees_secretes%>%gf_point(nb_canicule~dist_royaume,size=~nb_guerriers)%>%gf_text(nb_canicule~dist_royaume,label=~royaume,size=2.5,check_overlap = TRUE)

# Fin de l'exercice
``` 


```{r question1,echo=FALSE}
question("Alors, quel royaume faut-il attaquer? Il ne reste plus qu'à cocher la bonne réponse...pour poursuivre l'aventure!",
type="single",
allow_retry = TRUE,
incorrect="Retente ta chance",
answer("Le pays du soleil éternel	"),
answer("La terre d’Or"),
answer("Le territoire des Hauts",correct=TRUE),
answer("La bonne réponse n'est pas dans les propositions"),
correct="Félicitations, tu as trouvé le bon royaume, l'aventure peut continuer!"
)
```   

**Fin du chapitre 6  >>  reprenez la partie d'Icarius**