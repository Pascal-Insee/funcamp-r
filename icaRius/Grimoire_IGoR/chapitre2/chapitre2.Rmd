---
title: "Chapitre 2 - des poules et des oeufs"
output: 
  html_document:
    theme: cerulean
    highlight: haddock
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
    number_sections: false
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
rm(list=ls())
library(rio)
library(learnr)
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
```


## Le livre de compte, un ensemble de données

Vous venez de rencontrer la fermière du village Kokoro, désespérée d'avoir perdu le livre de compte où, chaque jour, elle note consciencieusement le nombre de pontes. 

Aidons IcaRius à reconstituer le livre de compte. Ce dernier n'est pas tout à fait perdu : il en reste une copie, éclatée dans plusieurs fragments par le redoutable sorcier SaSSoS ! Il y a ainsi un document par semaine de pontes, et il faut lire les 4 semaines de pontes pour recomposer le livre de compte.

Pour le corser le tout, chaque fragment a été ensorcelé et semble indéchiffrable... Ils sont en effet chacun dans d'étranges formats : SAS, Excel, Calc et Csv...

Aie aie aie. 

<span style="color:#18AC3E;font-size:16px">**Un Sasseur sait bien sasser... sur R ?**</span>

Commençons par le format SAS - qui rappellera peut-être quelques souvenirs aux aventuriers les plus aguerris. Nous allons donc apprendre, en R, à lire un fichier SAS. 

Le contenu de ce fichier - que seul le terrible SaSSoS est normalement capable de lire, est le suivant :

![](images/pontes_sas.png)

Pour charger un fichier, nous allons utiliser un sortilège prévu à cet effet dans R. Dans le monde des Runes, un sortilège est identifié par **son nom suivi de parenthèses** :`nomsortilege()`. A l'intérieur des parenthèses, sont précisés les ingrédients utiles à la confection du sortilège. Pas d'inquiétude, une aide intégrée dans R permet de connaître la liste des ingrédients que l'on peut renseigner pour chaque sortilège. Si plusieurs ingrédients sont nécessaires, ces derniers sont séparés par une virgule:

```{r, collapse = TRUE, eval=FALSE}
# Application d'un sortilège   
nomsortilege(ingredient1, ingredient2,...,ingredientN)

```

Pour lire un fichier SAS, nous allons utiliser le sortilège `import()` qui permet, comme son nom l'indique, d'importer (*import*) un fichier dans R. Pour utiliser `import()`, il y a un ingrédient à préciser : l’emplacement du fichier à lire.

```{r, collapse = TRUE, eval=FALSE}
# J'importe le fichier
import("chemin_du_fichier")
```

Pour s'y retrouver, autant tout de suite ranger ce que l'on est en train d'importer dans R. Pour cela, on assigne à un nouvel objet le contenu du fichier lu, en choisissant le nom de cet objet. Par exemple, appelons `livre_compte_1` ce qui sera importé dans R en lisant le fichier SAS. 

```{r, collapse = TRUE, eval=FALSE}
# J'importe le fichier et je l'assigne à l'objet livre_compte_1
livre_compte_1 <- import("chemin_du_fichier")
```

De cette façon, en appelant l'objet `livre_compte_1` dans la console R, il est aisé d'en consulter le contenu. En l'occurence :

```{r, echo=FALSE}
livre_compte_1 <- import("../../data/pontes_semaine1.sas7bdat")
```

```{r, collapse = FALSE}
# J'affiche le contenu de l'objet livre_compte_1
livre_compte_1
```

Et voilà, c'est fini pour le premier fichier ! Ce dernier comporte deux types d'information : le nom de la poule (colonne `Poule`) et le nombre d'oeufs pondus (colonne `Oeufs`). Il y a 6 enregistrements, un par poule. Par exemple, la poule Kokot a pondu 26 oeufs - c'est d'ailleurs la meilleure pondeuse de la semaine !

Et si vous pratiquiez vous-même ? Pour cela, il faut d'abord trouver l’emplacement du fichier à lire, sur votre poste de travail par exemple. En l'occurrence, le fichier est présent sur la clé USB qui vous a été remise en début de partie. Cherchons donc l'emplacement à partir  de l'explorateur dans windows. 

![](images/pontes_chemin.png)

<p style="border:1px; border-style:solid; border-color:#000000; padding: 1em;">
**Attention :** pour spécifier le chemin d’un fichier, il va falloir jongler avec les signes cabalistiques que sont les `/` et les `\` (ça ne s'appelle pas le langage des Runes pour rien). Contrairement à Windows où le backslash `\` est utilisé pour écrire un chemin, en R il faut écrire avec un slash `/`. Pensez donc à modifier le chemin du répertoire lors d'un copier coller de ce dernier depuis l’explorateur. Enfin, n'oubliez pas d'ajouter à la fin le nom du fichier (pontes_semaine1) avec son extension (.sas7bdat). 
</p>


Dans l'exemple ci-dessus, la bonne adresse pour notre fichier de ponte c'est donc `E:/icaRius/data/pontes_semaine1.sas7bdat`. Chargez vous-mêmes le fichier dans une table nommée `livre_compte_1`

```{r module2-question1,exercise=TRUE}
# Charger le fichier pontes_semaine1.sas7bdat en indiquant son chemin
# et assigner le résultat à l'objet nommé livre_compte_1


# Afficher le contenu de l'objet livre_compte_1

``` 

<div id="module2-question1-hint">
**Aide 1:** Utiliser la fonction import(). Veillez à indiquer le bon chemin entre parenthèses
</div>



<span style="color:#18AC3E;font-size:16px">**Tremblez, messieurs les tableurs **</span>


Bon, il nous reste à ouvrir les autres fragments. Deux d'entre eux correspondent à des fichiers produits par des tableurs, comme Excel (extension .xls ou xlsx) et Calc (extension .ods). Pour les ouvrir... nous allons utiliser le même sortilège que précédemment. Et oui : le sortilège `import()` permet aussi d'ouvrir les documents des tableurs ! Magiques !






La fonction `read.csv()` permet, comme son nom l'indique, de lire (*read*) un fichier CSV.

Nous l'avons vu au chapitre précédent : une fonction a des paramètres. Pour `read.csv`, il y a deux paramètres obligatoires : l’emplacement du fichier à lire et le type de séparateur du fichier.

```{r, collapse = TRUE, eval=FALSE}
ma_table<-read.csv(file="chemin_du_fichier", sep="separateur_du_fichier")
```

Le chemin du fichier doit préciser l'emplacement du document csv que vous cherchez à ouvrir, sur votre poste de travail par exemple. Cherchons donc l'emplacement à partir  de l'explorateur dans windows. 





<span style="color:#18AC3E;font-size:16px">**Une histoire de séparateur**</span>



Au fait, c'est quoi ? 

CSV, c'est un format de fichier où chaque enregistrement apparaît sur sa propre ligne et dont les champs sont séparés par un caractère unique appelé “séparateur”. En l'occurrence, le séparateur est une virgule ou un point-virgule : c'est d'ailleurs le sens de l'acronyme CSV, pour Comma Separated Value (Comma = virgule en anglais). 

<span style="color:#18AC3E;font-size:16px">**Un exemple de fichier CSV**</span>

Revenons à nos poules. Bonne nouvelle : IcaRius a trouvé, dans le poulailler, un document CSV qui pourrait bien nous aider à reproduire le livre de compte. 

<table style="width:400px">.
<tbody>
<tr>
  <th width="45%">Fichier au format .csv</th>
  <th width="10%"></th>
  <th width="45%">Représentation tabulaire</th>
</tr>
<tr valign="top">
  <td>
    <pre>Poule,Oeufs
Gertrude,22
Madame Mim,20
Poupoule,18
Daisy,16
Kokot,26
Chickitta,12</pre>
  </td>
  <td></td>
  <td>
  <table style="width:180px ;border: 1px solid black; border-collapse:collapse; text-align:center;">
    <tbody>
      <tr>
        <th scope="col">Poule</th>
        <th scope="col">Pontes</th>
      </tr>
      <tr>
        <td>Gertrude</td>
        <td>22</td>
      </tr>
      <tr>
        <td>Madame Mim</td>
        <td>20</td>
      </tr>    
      <tr>
        <td>Poupoule</td>
        <td>18</td>
      </tr>
      <tr>
        <td>Daisy</td>
        <td>16</td>
      </tr>
      <tr>
        <td>Kokot</td>
        <td>26</td>
      </tr>
      <tr>
        <td>Chickitta</td>
        <td>12</td>
      </tr>
    </tbody>
  </table>
  </td>
</tr>
</tbody>
</table>








Un fichier CSV peut être produit de multiples manières, et a l'avantage d'être utilisable aussi bien avec un tableur comme Excel ou Calc qu'avec des logiciels statistiques comme R. Vous pouvez même créer un fichier CSV "à la main", juste avec le Notepad dans windows par exemple.

![](images/pontes_csv.png)


## Chargeons le fichier

Pour charger un fichier, nous allons utiliser une fonction prévue à cet effet dans R. La fonction `read.csv()` permet, comme son nom l'indique, de lire (*read*) un fichier CSV.

Nous l'avons vu au chapitre précédent : une fonction a des paramètres. Pour `read.csv`, il y a deux paramètres obligatoires : l’emplacement du fichier à lire et le type de séparateur du fichier.

```{r, collapse = TRUE, eval=FALSE}
ma_table<-read.csv(file="chemin_du_fichier", sep="separateur_du_fichier")
```

Le chemin du fichier doit préciser l'emplacement du document csv que vous cherchez à ouvrir, sur votre poste de travail par exemple. Cherchons donc l'emplacement à partir  de l'explorateur dans windows. 

![](images/pontes_chemin.png)

<p style="border:1px; border-style:solid; border-color:#000000; padding: 1em;">
**Attention :** pour spécifier le chemin d’un fichier, il va falloir jongler avec les signes cabalistiques que sont les `/` et les `\` (ça ne s'appelle pas le langage des Runes pour rien). Contrairement à Windows (ou SAS) où le backslash `\` est utilisé pour écrire un chemin, en R il faut écrire avec un slash `/`. Pensez donc à modifier le chemin du répertoire lors d'un copier coller de ce dernier depuis l’explorateur. Enfin, n'oubliez pas d'ajouter à la fin le nom du fichier (pontes) avec son extension (.csv). 
</p>


Dans l'exemple ci-dessus, la bonne adresse pour notre fichier de ponte c'est donc `E:/icaRius/data/pontes.csv`. Il nous reste à préciser le séparateur, qui est ici une virgule `,`. C'est parti :


```{r, collapse = TRUE}
mon_fichier <- read.csv(file="E:/icaRius/data/pontes.csv", sep=",")
```

<span style="color:#18AC3E;font-size:16px">**A vous de jouer**</span> 

Chargez vous-mêmes le fichier `pontes.csv` qui se trouve dans le répertoire `E:\icaRius\data` dans une table nommée `mon_fichier`

```{r module2-question11,exercise=TRUE}
# Charger le ficher pontes.csv

``` 
 
<div id="module2-question11-hint">
**Aide 1:** Utiliser la fonction read.csv(file=,sep=). Veillez à indiquer le bon chemin (file=) vers le fichier et son séparateur (sep=) qui est une virgule (,)
</div>



## Découvrons le contenu du fichier

Nous voilà avec un fichier chargé dans R. 

<span style="color:#18AC3E;font-size:16px">**Affichage des premières lignes du fichier**</span> 

Pour afficher les premières lignes du fichier, nous allons utiliser la fonction `head()` (head = tête, début), en lui indiquant comme paramètre le nom du fichier tel que nous l'avons choisi, ici `mon_fichier`.

```{r, collapse = TRUE}
# Affichage des premières lignes contenues dans le fichier
head(mon_fichier) 
```

<span style="color:#18AC3E;font-size:16px">**Affichage du nom des variables**</span> 

La fonction `names()` permet de connaître les différentes variables comprises dans un fichier, ou dit autrement de connaître le nom des colonnes du tableau de données : 

```{r, collapse = TRUE}
# Affichage du nom des variables
names(mon_fichier) 
```

Notre registre des pontes comporte 3 variables : le jour de ponte `Jour`, l'appellation de la poule `Poule` et le nombre d'oeufs pondus `Oeufs`. 

<span style="color:#18AC3E;font-size:16px">**Affichage du nombre de lignes**</span> 

Reste à savoir combien d'observations - combien de lignes - comprend notre tableau de données. Mot à mot, nous voulons connaître le **n**ombre de lignes (**row** en anglais), d'où la fonction `nrow()`

```{r, collapse = TRUE}
# Affichage du nombre de lignes (nombre d'observations)
nrow(mon_fichier) 
```

Il y a 28 enregistrements dans le registre (28 lignes dans le tableau de données).

<span style="color:#18AC3E;font-size:16px">**A vous de jouer**</span> 

Manipulez vous-même le fichier des pontes utilisés dans ce tutoriel.

```{r,  echo=FALSE}
mon_fichier <- read.csv(file="E:/icaRius/data/pontes.csv", sep=",")
```

```{r module2-question2,exercise=TRUE}
# Le fichier 'pontes.csv' est déjà chargé dans R dans l'objet 'mon_fichier'
# Calculer le nombre de lignes de l'objet 'mon_fichier'

# Afficher le nom des variables de l'objet 'mon_fichier'

# Fin de l'exercice
``` 

```{r module2-question2-solution}
# Le fichier 'pontes.csv' est déjà chargé dans R dans l'objet 'mon_fichier'
# Calculer le nombre de lignes de l'objet 'mon_fichier'
nrow(mon_fichier)
# Afficher le nom des variables de l'objet 'mon_fichier'
names(mon_fichier)
# Fin de l'exercice
``` 



## Calculons le nombre d'oeufs pondus

<span style="color:#18AC3E;font-size:16px">**Accéder à une variable dans un fichier**</span> 

Notre fichier se compose de 3 variables (3 colonnes), qui ont chacune un nom : `Jour`, `Poule`, `Oeufs`. Une variable nommée `NomVariable` au sein d'un fichier `NomFichier` est accessible dans R comme un objet nommé `NomFichier$NomVariable`. C'est donc le signe `$` (encore un signe cabalistique) placé entre le nom du fichier et le nom de la variable qui permet d'indiquer à R que l'on souhaite accèder au contenu de cette variable.

Par exemple, le contenu de la variable `Oeufs` est accessible via `mon_fichier$Oeufs` : dans ce cas, R va me présenter l'ensemble des informations dans la colonne correspondante du tableau.

```{r, collapse = TRUE}
# Affichage des valeurs de la variable Oeufs
mon_fichier$Oeufs
```

Soyez vigilant(e) : R prend en compte les minuscules et les majuscules. Par exemple, dans le registre, les variables commencent par une majuscule. L'oublier va provoquer une erreur :

```{r, collapse = TRUE}
# Erreur sur le nom de la variable (o minuscule au lieu de O majuscule)
mon_fichier$oeufs
```

<span style="color:#18AC3E;font-size:16px">**Connaître les valeurs d'une variable**</span> 

Une variable peut présenter des valeurs récurrentes, que l'on appelle des modalités. Par exemple, le poulailler ne comprend que 4 poules, chacune avec leur petit nom. Le nom d'une poule est une modalité de la variable `mon_fichier$Poule`. Si je veux connaître la liste des prénoms des poules (la liste des modalités de la variable `Poule`), j'utilise la fonction `levels` (level = niveau, une modalité étant comme un "niveau" dans une liste de valeurs possibles).

```{r, collapse = TRUE}
# Quels sont les noms des poules pondeuses ?
levels(mon_fichier$Poule) 
```

<span style="color:#18AC3E;font-size:16px">**Sommer une variable**</span> 

Chaque ligne du registre indique le nombre d'oeufs pondus pour une poule et pour un jour de la semaine. Pour savoir le nombre d'oeufs pondus (enfin !), il vous reste à sommer les valeurs de la variable `Oeufs` avec la fonction `sum()` (somme en anglais)

```{r, collapse = TRUE}
# Combien d'oeufs ont été pondus au total selon le registre ?
sum(mon_fichier$Oeufs) 
```

Gagné ! Il y a 81 oeufs pondus selon le registre.


## A vous de calculer le nombre d'oeufs

**Sauf que... toutes ces explications portaient sur un faux registre !** A vous désormais d'appliquer ces calculs sur le véritable registre, qui figure dans votre répertoire ici : `E:/icaRius/data/registre_pontes.csv`.

<span style="color:#18AC3E;font-size:16px">**Chargez le fichier 'registre_pontes.csv' et explorez son contenu**</span>


```{r module2-question3,exercise=TRUE}
# Chargez le ficher 'registre_pontes.csv' dans un objet appelé 'registre'

# Affichez le nom des variables de l'objet 'registre'

# Affichez les premières lignes de l'objet 'registre'

# fin de l'exercice
``` 
 
```{r module2-question3-solution}
# Charger le ficher 'registre_pontes.csv' dans un objet appelé 'registre'
registre <- read.csv(file="E:/icaRius/data/registre_pontes.csv", sep=",")
# Connaitre le nom des variables
names(registre)
# Affichage des premières lignes
head(registre)
# fin de l'exercice
``` 

<div id="module2-question3-hint">
**Aide 1:** Utiliser la fonction read.csv(file=,sep=). Veillez à indiquer le bon chemin (file=) vers le registre et son séparateur (sep=) qui est une virgule (,)
**Aide 2:** Utiliser la fonction names()
**Aide 3:** Utiliser la fonction head()
</div>


<span style="color:#18AC3E;font-size:16px">**Calculer le nombre total des pontes**</span> 

```{r,  echo=FALSE}
registre <- read.csv(file="E:/icaRius/data/registre_pontes.csv", sep=",")
```

```{r module2-question4,exercise=TRUE}
# Le registre des pontes est déjà chargé dans l'objet 'registre'
# La variable sur le nombre de pontes par jour s'appelle 'Oeufs'
# Calculer la somme de la variable Oeufs


# Fin de l'exercice
``` 

<div id="module2-question4-hint">
**Aide:** Utiliser la fonction sum()
</div>


```{r question1,echo=FALSE}
question("Alors, quel est le total des pontes ? Ne reste plus qu'à cocher la bonne réponse...pour poursuivre l'aventure!",
type="single",
allow_retry = TRUE,
incorrect="Retente ta chance",
answer("67"),
answer("78"),
answer("91",correct=TRUE),
answer("La bonne réponse n'est pas dans les propositions"),
correct="Félicitations, tu as trouvé le total des pontes, l'aventure peut continuer!"
)

```   

Vous avez trouvé ? **Reportez le nombre total de pontes dans le jeu Icarius** pour reprendre la partie...

**Fin du chapitre 2 >> reprenez la partie d'Icarius !!!** 